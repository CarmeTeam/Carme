{% comment %}
# ----------------------------------------------
# Carme
# ----------------------------------------------
# base.html - defining the basic page layout
#
# see Carme development guide for documentation:
# * Carme/Carme-Doc/DevelDoc/CarmeDevelopmentDocu.md
#
# Copyright 2019 by Fraunhofer ITWM
# License: http://open-carme.org/LICENSE.md
# Contact: info@open-carme.org
# ---------------------------------------------
{% endcomment %}

{% load static %}

<!doctype html>
<html lang="en" class="h-100">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

	<!-- Font Awesome CSS -->
	<link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">

	<!-- Custom CSS -->
	<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">

	<!-- Page title -->
	<title>{% block title %}Fraunhofer GPU-Cluster login{% endblock %}</title>

	<!-- Favicons -->
	<link rel="apple-touch-icon" sizes="57x57" href="{% static 'favicon/apple-icon-57x57.png' %}">
	<link rel="apple-touch-icon" sizes="60x60" href="{% static 'favicon/apple-icon-60x60.png' %}">
	<link rel="apple-touch-icon" sizes="72x72" href="{% static 'favicon/apple-icon-72x72.png' %}">
	<link rel="apple-touch-icon" sizes="76x76" href="{% static 'favicon/apple-icon-76x76.png' %}">
	<link rel="apple-touch-icon" sizes="114x114" href="{% static 'favicon/apple-icon-114x114.png' %}">
	<link rel="apple-touch-icon" sizes="120x120" href="{% static 'favicon/apple-icon-120x120.png' %}">
	<link rel="apple-touch-icon" sizes="144x144" href="{% static 'favicon/apple-icon-144x144.png' %}">
	<link rel="apple-touch-icon" sizes="152x152" href="{% static 'favicon/apple-icon-152x152.png' %}">
	<link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-icon-180x180.png' %}">
	<link rel="icon" type="image/png" sizes="192x192" href="{% static 'favicon/android-icon-192x192.png' %}">
	<link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/favicon-32x32.png' %}">
	<link rel="icon" type="image/png" sizes="96x96" href="{% static 'favicon/favicon-96x96.png' %}">
	<link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/favicon-16x16.png' %}">
</head>

{% if user.is_authenticated %}
<body class="d-flex flex-column h-100 space-top">
	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
		<a class="navbar-brand" href="/">Carme</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
			aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarsExampleDefault">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item{% if '/' == request.path %} active{% endif %}">
					<a class="nav-link" href="/">Dashboard <span class="sr-only">(current)</span></a>
				</li>
				<li class="nav-item{% if '/carme/JobHist' in request.path %} active{% endif %}">
					<a class="nav-link" href="/carme/JobHist/">History</a>
				</li>

				{% if user.is_superuser %}
				<li class="nav-item dropdown{% if '/carme/AdminAllJobs/' in request.path %} active{% endif %}">
					<a class="nav-link dropdown-toggle" href="#" id="dropdown-admin" data-toggle="dropdown"
						aria-haspopup="true" aria-expanded="false">Admin</a>
					<div class="dropdown-menu" aria-labelledby="dropdown-admin">
						<a class="dropdown-item" href="/carme/AdminAllJobs/"><i class="fa fa-tasks fa-fw"
								aria-hidden="true"></i>&nbsp; All jobs</a>
						{% if maintenance_mode %}
						<a class="dropdown-item" href="/carme/maintenance-mode/off/"><i class="fa fa-unlock fa-fw"
								aria-hidden="true"></i>&nbsp; Maintenance off</a>
						{%else %}
						<a class="dropdown-item" href="/carme/maintenance-mode/on/"><i class="fa fa-lock fa-fw"
								aria-hidden="true"></i>&nbsp; Maintenance on</a>
						{% endif %}
						<div class="dropdown-divider"></div>
						<a class="dropdown-item" href="/wiki/cluster_news/" target="_blank"><i
								class="fa fa-newspaper-o fa-fw" aria-hidden="true"></i>&nbsp; Edit news</a>
						<a class="dropdown-item" href="/admin/" target="_blank"><i class="fa fa-wrench fa-fw"
								aria-hidden="true"></i>&nbsp; Admin portal</a>
						{% if settings.CARME_FRONTEND_LINK_PROXY|length > 0 %}
						<a class="dropdown-item" href={{ settings.CARME_FRONTEND_LINK_PROXY }} target="_blank"><i
								class="fa fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp; Proxy</a>
						{% endif %}
						{% if settings.CARME_FRONTEND_LINK_MONITOR|length > 0 %}
						<a class="dropdown-item" href={{ settings.CARME_FRONTEND_LINK_MONITOR }} target="_blank"><i
								class="fa fa-dashboard fa-fw" aria-hidden="true"></i>&nbsp; Monitoring</a>
						{% endif %}
						{% if settings.CARME_FRONTEND_LINK_SWITCH|length > 0 %}
						<a class="dropdown-item" href={{ settings.CARME_FRONTEND_LINK_SWITCH }} target="_blank"><i
								class="fa fa-sitemap fa-fw" aria-hidden="true"></i>&nbsp; Switch</a>
						{% endif %}
						{% if settings.CARME_FRONTEND_LINK_LDAP|length > 0 %}
						<a class="dropdown-item" href={{ settings.CARME_FRONTEND_LINK_LDAP }} target="_blank"><i
								class="fa fa-users fa-fw" aria-hidden="true"></i>&nbsp; LDAP</a>
						{% endif %}
						{% if CARME_VERSION %}
						<div class="dropdown-divider"></div>
						<p class="mb-0 px-4 py-1"><b>Version</b> {{ CARME_VERSION }}</p>
						{% endif %}
					</div>
				</li>
				{% endif %}

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="dropdown-external" data-toggle="dropdown"
						aria-haspopup="true" aria-expanded="false">Help</a>
					<div class="dropdown-menu" aria-labelledby="dropdown-external">
						<a class="dropdown-item" href="/wiki" target="_blank"><i class="fa fa-wikipedia-w fa-fw"
								aria-hidden="true"></i>&nbsp; Wiki</a>
						<a class="dropdown-item" href="https://carmeteam.github.io/Carme-Docu/" target="_blank"><i
								class="fa fa-book fa-fw" aria-hidden="true"></i>&nbsp; Documentation</a>
					</div>
				</li>

			</ul>

			<ul class="navbar-nav mx-2">
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="dropdown-user" data-toggle="dropdown"
						aria-haspopup="true" aria-expanded="false"><i class="fa fa-user" aria-hidden="true"></i>&nbsp;
						{{ user.username }}&nbsp;</a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdown-user">
						<a class="dropdown-item" href="/carme/password/"><i class="fa fa-key fa-fw"
								aria-hidden="true"></i>&nbsp; Change password</a>
						<div class="dropdown-divider"></div>
						<dl class="row no-gutters mb-0 px-4 py-1" style="width: 250px">
							<dt class="col-sm-5">Group</dt>
							<dd class="col-sm-7">{% for g in user.ldap_user.group_names %}{{g}} {%endfor%}</dd>

							<dt class="col-sm-5">Session timeout</dt>
							<dd class="col-sm-7">{{request.session.get_expiry_date}}</dd>
						</dl>
					</div>
				</li>
			</ul>

			<a class="btn btn-secondary my-2 my-sm-0" href="/logout/">Logout</a>
		</div>
	</nav>
{% else %}
<body class="d-flex flex-column h-100">
{% endif %}


 <section class="container-fluid flex-grow-1 bg-main">
        <main role="main" class="flex-shrink-0">
         {% include "blocks/maintenance.html" %}
         {% block content %} {% endblock %} 
        </main> 
 </section>


<!-- Footer -->
<footer class="text-center text-lg-start bg-light text-muted">

  <section class="justify-content-center  border-top">
    <div class="container-footer">  
      <div class="row mt-2 mx-0">   
        <div class="col-md-2 col-lg-2 col-xl-2 ">
          {% if settings.CARME_FRONTEND_LINK_DISCLAIMER|length > 0 %}
          <h6 class="fw-bold mb-3">
            <a href="{{ settings.CARME_FRONTEND_LINK_DISCLAIMER }}" target="_blank" class="me-4 text-reset">Disclaimer</a>
          </h6>
          {% endif %}
        </div>
        <div class="col-md-2 col-lg-2 col-xl-2 ">
          {% if settings.CARME_FRONTEND_LINK_PRIVACY|length > 0 %}
          <h6 class="fw-bold mb-3">
            <a href="{{ settings.CARME_FRONTEND_LINK_PRIVACY }}" target="_blank" class="me-4 text-reset">Data Privacy</a>
          </h6>
          {% endif %}
        </div>

        <div class="col-md-2 offset-md-6 col-lg-2 offset-lg-6 col-xl-2 offset-xl-6 mb-md-0 ">
          <h6 class="fw-bold mb-3">
            <a href="https://twitter.com/open_carme" target="_blank" class="me-4 text-reset text-decoration-none">
              <i class="fa fa-twitter px-1"></i>
            </a>
            <a href="/wiki/" class="me-4 text-reset text-decoration-none">
              <i class="fa fa-wikipedia-w px-1"></i>
            </a>
            <a href="https://github.com/CarmeTeam/Carme" target="_blank" class="me-4 text-reset text-decoration-none">
              <i class="fa fa-github px-1"></i>
            </a>
          </h6>
        </div>

      </div>
    </div>
  </section>

  <div class="text-center p-2" style="background-color: rgba(0, 0, 0, 0.05);">
    Â© 2018-<script>document.write(new Date().getFullYear())</script>
    <a class="text-reset fw-bold" href="https://carmeteam.github.io/Carme/" target="_blank">Carme</a>
  </div>
</footer>
<!-- Footer --> 


	<!-- JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="{% static 'js/jquery.min.js' %}"></script>
	<script src="{% static 'js/popper.min.js' %}"></script>
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
	<script type="text/javascript">
		if (!$) console.error('jQuery is required!');
		else {
			$(document).on('submit', 'form.ajax', function (event) {
				// source: https://www.sanwebe.com/2016/07/ajax-form-submit-examples-using-jquery
				event.preventDefault(); //prevent default action

				var post_url = $(this).attr("action"); //get form action url
				var request_method = $(this).attr("method"); //get form GET/POST method
				var form_data = $(this).serialize(); //Encode form elements for submission

				$.ajax({
					url: post_url,
					type: request_method,
					data: form_data
				}).fail(function () {
					console.error('Request to ' + post_url + ' failed. Please try again.');
				}).always(function () {
					setTimeout(function () {
						//document.location.reload();
					}, 1000);
				});
			});
		}
	</script>
	{% block javascript %}
	{% endblock %}
</body>

</html>
